App.views.DichotemousKey=Ext.extend(Ext.Panel,{layout:"fit",fullscreen:true,scroll:true,dockedItems:[{dock:"top",xtype:"toolbar",ui:"light",cls:"header",items:[{text:"Back",ui:"back",handler:function(){if(App.viewport.keyView.gameStack.length==1){return}else{App.viewport.keyView.transitionPage();App.viewport.keyView.gameStack.pop();var b=App.viewport.keyView.seekTopGameStack()[0].key_pair;var a=fossil_key.find_statement_pair(b);App.viewport.keyView.updatePage(a)}}},{xtype:"spacer"},{text:"Home",handler:function(){App.viewport.navTo("home")}}]}],gameStack:new Array(),restartPage:function(){this.startGame();var a=this.seekTopGameStack();this.updatePage(a)},updatePage:function(b){var a=this.getQuestionHtml(b);this.update(a);this.fireEvent("show")},checkKeyAlreadyOnStack:function(a){var b=this.seekTopGameStack();if(b==false){return false}return(b[0].key_pair==a)},startGame:function(){var a=fossil_key.start();this.gameStack=new Array();this.gameStack.push(a)},getQuestionHtml:function(a){var b=Ext.XTemplate.from("keyOptions");return b.apply(a)},seekTopGameStack:function(){if(this.gameStack.length==0){return null}return this.gameStack[this.gameStack.length-1]},getNextStatement:function(a){var c=this.seekTopGameStack();var b=c[a];return b.next_statement_pair},initComponent:function(){this.startGame();var b=this.seekTopGameStack();var a=this.getQuestionHtml(b);this.html=a;App.views.DichotemousKey.superclass.initComponent.call(this)},getSpecimen:function(b){var a=this.seekTopGameStack()[b];return a.specimen},listeners:{afterlayout:function(){this.bindOurEvents()},show:function(){this.bindOurEvents()}},transitionPage:function(){App.viewport.keyView.update('<div class="transition-key"> ... </div> ')},bindOurEvents:function(){$(".key-option").bind("touchstart",function(b){var a=$(b.target).closest(".key-option")[0];$(a).css("background-color","#888")});$(".key-option").bind("tap",function(d){var a=$(d.target).closest(".key-option")[0];if(a!=undefined){var c=a.getAttribute("data-selectedoption");$(a).css("background-color","");if(!c){var e=a.getAttribute("data-index");var f=App.viewport.keyView.getSpecimen(e-1);App.viewport.navTo("specimen",f,"key");return}App.viewport.keyView.transitionPage();var c=parseInt(c);var b=fossil_key.find_statement_pair(c);if(App.viewport.keyView.checkKeyAlreadyOnStack(c)==false){App.viewport.keyView.gameStack.push(b)}App.viewport.keyView.updatePage(b)}})}});